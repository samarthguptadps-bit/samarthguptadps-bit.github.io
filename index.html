<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ROBO-MATH: MASTER EDITION</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-orange: #ff9d00;
            --neon-purple: #bc13fe;
            --neon-green: #39ff14;
            --bright-bg: #050a1f;
            --card-bg: rgba(15, 25, 55, 0.95);
        }

        body {
            background-color: var(--bright-bg);
            background-image: radial-gradient(circle at 50% 50%, #1e3a8a 0%, #050a1f 100%);
            color: white; font-family: 'Segoe UI', sans-serif; margin: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow-x: hidden;
            overscroll-behavior-y: contain;
        }

        .math-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1; overflow: hidden;
        }
        .symbol {
            position: absolute; color: rgba(0, 242, 255, 0.2);
            font-size: 1.5rem; font-weight: bold; animation: floatUp 10s infinite linear;
        }
        @keyframes floatUp {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        .creator-tag {
            position: fixed; top: 10px; right: 10px;
            background: rgba(0,0,0,0.8); border: 1px solid var(--neon-blue);
            padding: 5px 15px; border-radius: 5px; z-index: 1000;
            font-size: 0.8rem; color: var(--neon-blue); font-weight: bold;
        }

        .header-title {
            text-align: center; padding: 30px 0 10px 0;
            font-size: 2.5rem; text-shadow: 0 0 20px var(--neon-blue);
            letter-spacing: 5px; color: white;
        }

        .id-card { background: var(--card-bg); padding: 15px; width: 100%; display: flex; justify-content: center; gap: 10px; border-bottom: 3px solid var(--neon-blue); flex-wrap: wrap; box-sizing: border-box;}
        .id-card input { border: 2px solid var(--neon-purple); padding: 8px; width: 150px; border-radius: 5px; background: #000; color: white; text-align: center; }

        .nav-switch { margin: 20px 0; display: flex; gap: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 50px; border: 2px solid var(--neon-blue); }
        .nav-btn { padding: 10px 25px; border: none; border-radius: 40px; cursor: pointer; font-weight: bold; background: transparent; color: white; transition: 0.3s; }
        .nav-btn.active { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); }

        .full-section { width: 95%; display: none; padding-bottom: 50px; max-width: 1200px; }
        .full-section.active { display: block; }

        .logic-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .logic-card { background: var(--card-bg); border-left: 5px solid var(--neon-green); padding: 15px; border-radius: 10px; }
        .mcq-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .opt-btn { background: #000; border: 1px solid #444; color: white; padding: 8px; cursor: pointer; border-radius: 4px; transition: 0.2s; text-align: left; }
        .opt-btn:hover { border-color: var(--neon-blue); }
        .opt-btn.selected { border-color: var(--neon-orange); background: rgba(255, 157, 0, 0.1); }
        .opt-btn.correct-ui { background: var(--neon-green) !important; color: black; font-weight: bold; }
        .opt-btn.wrong-ui { background: #ff3333 !important; color: white; }

        .rapid-fire-zone { 
            background: rgba(255, 0, 0, 0.1); border: 2px solid #ff3333; padding: 30px; 
            border-radius: 20px; margin-top: 40px; text-align: center; position: relative;
        }
        #rf-timer { font-size: 2.5rem; color: #ff3333; font-family: monospace; text-shadow: 0 0 10px #ff3333; }
        .rf-quest-box { margin-top: 20px; font-size: 1.2rem; min-height: 150px; }

        .math-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 40px;}
        .game-block { background: var(--card-bg); border: 2px solid var(--neon-purple); border-radius: 20px; padding: 20px; position: relative; min-height: 300px;}
        .core-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; border-radius: 18px; text-align: center;}
        .activate-btn { background: var(--neon-blue); color: black; padding: 10px 20px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 10px;}
        .game-block.unlocked .core-overlay { display: none; }
        
        .core-timer-display { font-family: monospace; color: var(--neon-green); font-size: 1.2rem; margin-bottom: 10px; text-shadow: 0 0 5px var(--neon-green); }

        .chip { 
            background: white; color: black; padding: 8px; margin: 5px 0; cursor: grab; 
            border-radius: 5px; font-size: 0.85rem; text-align: center; font-weight: bold; 
            width: 90%; touch-action: none; user-select: none;
        }
        .slot { background: #000; border: 1px dashed var(--neon-blue); min-height: 35px; margin: 5px 0; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; color: var(--neon-orange); width: 120px;}
        
        .reset-core-btn { margin-top: 15px; padding: 5px 15px; background: #333; color: #ccc; border: 1px solid #555; border-radius: 4px; cursor: pointer; font-size: 0.7rem; }
        .reset-core-btn:hover { background: #444; color: white; }

        .sudoku-container { display: flex; flex-wrap: wrap; gap: 25px; justify-content: center; padding: 20px; }
        .sudoku-wrapper { text-align: center; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; border: 1px solid #333; }
        .sudoku-board { display: grid; grid-template-columns: repeat(9, 28px); grid-template-rows: repeat(9, 28px); border: 2px solid var(--neon-blue); background: #111; }
        .s-cell { width: 28px; height: 28px; border: 0.1px solid #333; display: flex; align-items: center; justify-content: center; background: #222; color: var(--neon-blue); font-size: 14px; font-weight: bold; }
        .s-cell.prefilled { background: #1a1a1a; color: #888; }
        .s-cell input { width: 100%; height: 100%; border: none; text-align: center; font-size: 14px; background: white; color: black; outline: none; }
        .level-tag { margin-bottom: 10px; font-weight: bold; color: var(--neon-orange); text-transform: uppercase; letter-spacing: 1px; }

        .s-cell:nth-child(3n) { border-right: 2px solid var(--neon-blue); }
        .s-cell:nth-child(9n) { border-right: 0.1px solid #333; }
        .sudoku-board > div:nth-child(n+19):nth-child(-n+27),
        .sudoku-board > div:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid var(--neon-blue); }

        .verify-btn { margin-top: 15px; padding: 8px 15px; background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue); cursor: pointer; font-weight: bold; border-radius: 5px; transition: 0.3s; }
        .verify-btn:hover { background: var(--neon-blue); color: black; }

        .archive-strip { background: rgba(15, 25, 55, 0.7); border-left: 5px solid var(--neon-blue); padding: 20px; margin-bottom: 20px; border-radius: 0 15px 15px 0; }
        
        #custom-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: black; padding: 30px; border-radius: 15px; border: 5px solid var(--neon-blue); z-index: 2000; text-align: center; width: 80%; max-width: 400px;}
        .overlay-bg { display: none; position: fixed; top:0; left:0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1999; }
    </style>
</head>
<body>

<div class="math-bg" id="bg-layer"></div>
<div class="creator-tag">SYSTEM OPERATOR: SAMARTH | UNIT: 7C</div>
<div class="header-title">ROBO-MATH</div>

<div class="id-card">
    <input type="text" placeholder="PLAYER NAME">
    <input type="text" placeholder="SECTION">
    <input type="text" placeholder="ROLL NO.">
</div>

<div class="nav-switch">
    <button class="nav-btn active" onclick="showSection('section-a', this)">SECTION A: LOGIC & VAULT</button>
    <button class="nav-btn" onclick="showSection('section-b', this)">SECTION B: MATH CORES</button>
    <button class="nav-btn" onclick="showSection('section-c', this)">SECTION C: ARCHIVES</button>
</div>

<div id="section-a" class="full-section active">
    <h2 style="text-align:center; color: var(--neon-orange);">SUDOKU VAULT: 6 PROGRESSIVE LEVELS</h2>
    <div class="sudoku-container" id="sudoku-vault"></div>
    <hr style="border-color: #222; margin: 40px 0;">
    <h2 style="text-align:center; color: var(--neon-green);">LOGICAL ANALYSIS (MCQ)</h2>
    <div class="logic-grid" id="logic-questions"></div>
    <div style="text-align: center; margin-top: 30px;">
        <button onclick="submitLogicExam()" style="padding: 15px 50px; background: var(--neon-green); border: none; border-radius: 5px; font-weight: bold; cursor: pointer; color: black;">SUBMIT ANALYSIS</button>
    </div>
</div>

<div id="section-b" class="full-section">
    <h2 style="text-align:center; color: var(--neon-blue);">ADVANCED MATH CORES</h2>
    <div class="math-container" id="master-container"></div>

    <div class="rapid-fire-zone">
        <h2 style="color: #ff3333; text-shadow: 0 0 10px #ff3333;">⚠️ WARNING: RAPID FIRE MODE ⚠️</h2>
        <p>10 Tricky Questions | 2.5 Minutes | Pure Critical Thinking</p>
        <div id="rf-timer">02:30</div>
        <button id="start-rf-btn" onclick="startRapidFire()" style="padding: 15px 40px; background: #ff3333; color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px;">INITIALIZE RAPID FIRE</button>
        
        <div id="rf-game-area" style="display:none;">
            <div class="rf-quest-box">
                <h3 id="rf-question-text"></h3>
                <div class="mcq-container" id="rf-options" style="max-width: 600px; margin: 20px auto;"></div>
            </div>
        </div>
        
        <div id="rf-complete-area" style="display:none; margin-top: 20px;">
            <h2 style="color: var(--neon-green);">SYSTEM SYNCED!</h2>
            <button onclick="resetRF(true)" style="padding: 15px 40px; background: var(--neon-blue); color: black; border: none; font-weight: bold; cursor: pointer; border-radius: 5px;">RELOAD NEW DATASET (ENDLESS)</button>
        </div>
    </div>
</div>

<div id="section-c" class="full-section">
    <h2 style="text-align:center; color: var(--neon-blue);">ARCHIVE LOGS</h2>
    <div id="archive-content">
        <div class="archive-strip">
            <h3 style="color: var(--neon-orange);">Aryabhata (476–550 CE)</h3>
            <p>Aryabhata was a pioneer who transformed mathematics by introducing the concept of place value and zero as a placeholder...</p>
        </div>
        <div class="archive-strip" style="border-left-color: var(--neon-purple);">
            <h3 style="color: var(--neon-purple);">Brahmagupta (598–668 CE)</h3>
            <p>Brahmagupta was the first mathematician to treat zero as a proper number...</p>
        </div>
        <div class="archive-strip" style="border-left-color: var(--neon-blue);">
            <h3 style="color: var(--neon-blue);">Sir Isaac Newton (1643–1727)</h3>
            <p>Sir Isaac Newton redefined the universe by linking mathematics to physical reality...</p>
        </div>
        <div class="archive-strip" style="border-left-color: var(--neon-green);">
            <h3 style="color: var(--neon-green);">Srinivasa Ramanujan (1887–1920)</h3>
            <p>Srinivasa Ramanujan was a self-taught genius who made extraordinary contributions...</p>
        </div>
        <div class="archive-strip" style="border-left-color: #fff;">
            <h3 style="color: #fff;">Albert Einstein (1879–1955)</h3>
            <p>Albert Einstein used high-level mathematics to prove that space and time are not fixed...</p>
        </div>
    </div>
</div>

<div id="custom-modal">
    <h2 id="modal-msg"></h2>
    <p id="modal-submsg" style="font-size: 0.9rem; margin-bottom: 20px;"></p>
    <button onclick="closeModal()" style="padding: 10px 20px; background: var(--neon-purple); color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 4px;">DISMISS</button>
</div>
<div class="overlay-bg" id="modal-overlay"></div>

<script>
    // --- UTILITIES ---
    function initBG() {
        const bg = document.getElementById('bg-layer');
        const syms = ['+', '-', '×', '÷'];
        for(let i=0; i<30; i++) {
            let s = document.createElement('div');
            s.className = 'symbol';
            s.innerText = syms[Math.floor(Math.random()*syms.length)];
            s.style.left = Math.random() * 100 + 'vw';
            s.style.animationDuration = (Math.random() * 5 + 5) + 's';
            s.style.animationDelay = (Math.random() * 10) + 's';
            bg.appendChild(s);
        }
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.rate = 1;
            msg.pitch = 1.2;
            window.speechSynthesis.speak(msg);
        }
    }

    // --- LOGIC SECTION DATA (SECTION A) ---
    const logicData = [
        { q: "If 3x + 7 = 22, what is x?", o: ["3", "5", "7", "15"], a: "5" },
        { q: "A triangle has angles 40° and 60°. Third angle?", o: ["80°", "100°", "90°", "70°"], a: "80°" },
        { q: "Next in sequence: 2, 6, 12, 20, 30...?", o: ["36", "40", "42", "48"], a: "42" },
        { q: "Simplify: (-15) + (-10) - (-5)", o: ["-30", "-20", "-15", "0"], a: "-20" },
        { q: "Speed of car traveling 120km in 2 hours?", o: ["60km/h", "240km/h", "30km/h", "50km/h"], a: "60km/h" },
        { q: "Sum of three consecutive integers is 33. Smallest?", o: ["9", "10", "11", "12"], a: "10" },
        { q: "If a=2, b=3, find (a² + b² - ab).", o: ["5", "7", "13", "1"], a: "7" },
        { q: "What is 15% of 200 + 25% of 100?", o: ["50", "45", "55", "30"], a: "55" },
        { q: "Find mean of: 5, 8, 12, 5, 10.", o: ["7", "8", "9", "10"], a: "8" },
        { q: "Rect park: 20m long, 15m wide. Perimeter?", o: ["35m", "300m", "70m", "100m"], a: "70m" }
    ];

    let userSelections = new Array(10).fill(null);

    function initLogic() {
        const container = document.getElementById('logic-questions');
        logicData.forEach((item, i) => {
            let optionsHTML = item.o.map(opt => `<button class="opt-btn" onclick="selectOption(${i}, '${opt}', this)">${opt}</button>`).join('');
            container.innerHTML += `<div class="logic-card" id="logic-card-${i}"><p><strong>Q${i+1}:</strong> ${item.q}</p><div class="mcq-container" id="logic-opts-${i}">${optionsHTML}</div></div>`;
        });
    }

    function selectOption(qIdx, val, btn) {
        userSelections[qIdx] = val;
        let parent = document.getElementById(`logic-opts-${qIdx}`);
        parent.querySelectorAll('.opt-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }

    function submitLogicExam() {
        let score = 0;
        logicData.forEach((item, i) => {
            let opts = document.getElementById(`logic-opts-${i}`).querySelectorAll('.opt-btn');
            opts.forEach(btn => {
                btn.disabled = true;
                if(btn.innerText === item.a) btn.classList.add('correct-ui');
                if(btn.classList.contains('selected') && btn.innerText !== item.a) btn.classList.add('wrong-ui');
            });
            if(userSelections[i] === item.a) score++;
        });
        showPopup(`ANALYSIS COMPLETE`, `Final Data Score: ${score}/10`);
    }

    // --- MATH CORES (SECTION B) ---
    const coreData = {
        g1: { title: "EXPONENTS", pairs: [{q:"2²", a:"4"}, {q:"3²", a:"9"}, {q:"4²", a:"16"}, {q:"5²", a:"25"}, {q:"10²", a:"100"}]},
        g2: { title: "PERCENTS", pairs: [{q:"50%", a:"1/2"}, {q:"25%", a:"1/4"}, {q:"75%", a:"3/4"}, {q:"10%", a:"1/10"}, {q:"20%", a:"1/5"}]},
        g3: { title: "PRIMES", pairs: [{q:"Smallest Prime", a:"2"}, {q:"Next after 7", a:"11"}, {q:"Is 15 Prime?", a:"No"}, {q:"Prime before 20", a:"19"}, {q:"Is 29 Prime?", a:"Yes"}]},
        g4: { title: "GEOMETRY", pairs: [{q:"Hexagon", a:"6 Sides"}, {q:"Octagon", a:"8 Sides"}, {q:"Pentagon", a:"5 Sides"}, {q:"Nonagon", a:"9 Sides"}, {q:"Decagon", a:"10 Sides"}]},
        g5: { title: "ALGEBRA", pairs: [{q:"x + 5 = 12", a:"x=7"}, {q:"2x = 20", a:"x=10"}, {q:"x - 3 = 10", a:"x=13"}, {q:"x / 2 = 4", a:"x=8"}, {q:"3x = 15", a:"x=5"}]}
    };

    let coreTimers = {};

    function initMathCores() {
        const container = document.getElementById('master-container');
        container.innerHTML = "";
        Object.keys(coreData).forEach(id => {
            const data = coreData[id];
            const block = document.createElement('div'); block.className = 'game-block'; block.id = `block-${id}`;
            block.innerHTML = `
                <div class="core-overlay" id="overlay-${id}">
                    <div class="core-timer-display" id="timer-disp-${id}">03:00</div>
                    <button class="activate-btn" onclick="activateCore('${id}')">ACTIVATE ${data.title}</button>
                </div>
                <h3 style="color:var(--neon-orange); margin:0 0 5px 0;">${data.title}</h3>
                <div id="active-timer-${id}" style="font-family:monospace; color:var(--neon-blue); font-size:0.8rem; margin-bottom:10px;">TIME LEFT: 03:00</div>
                <div style="display:flex; justify-content:space-between; gap:10px;">
                    <div id="q-${id}" style="flex:1"></div>
                    <div id="a-${id}" style="width:120px"></div>
                </div>
                <button class="reset-core-btn" onclick="resetCore('${id}')">RESET CORE</button>`;
            
            [...data.pairs].sort(()=>Math.random()-0.5).forEach((p, i) => {
                let q = document.createElement('div'); q.className='chip'; q.innerText=p.q; q.id=`${id}-q-${i}`; q.dataset.ans=p.a; q.draggable=true;
                q.addEventListener('touchstart', handleTS, {passive: false});
                q.addEventListener('touchmove', handleTM, {passive: false});
                q.addEventListener('touchend', handleTE, {passive: false});
                q.ondragstart=(e)=>e.dataTransfer.setData("text", e.target.id);
                block.querySelector(`#q-${id}`).appendChild(q);
            });
            
            [...data.pairs].sort(()=>Math.random()-0.5).forEach((p, i) => {
                let s = document.createElement('div'); s.className='slot'; s.dataset.ans=p.a; s.innerText=p.a;
                s.ondragover=(e)=>e.preventDefault();
                s.ondrop=(e)=>{ 
                    let tId = e.dataTransfer.getData("text");
                    processDrop(tId, e.target);
                };
                block.querySelector(`#a-${id}`).appendChild(s);
            });
            container.appendChild(block);
        });
    }

    function activateCore(id) {
        document.getElementById(`block-${id}`).classList.add('unlocked');
        startCoreTimer(id);
    }

    function startCoreTimer(id) {
        let timeLeft = 180;
        const display = document.getElementById(`active-timer-${id}`);
        clearInterval(coreTimers[id]);
        coreTimers[id] = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft / 60), s = timeLeft % 60;
            display.innerText = `TIME LEFT: ${m}:${s < 10 ? '0' : ''}${s}`;
            if (timeLeft <= 0) {
                clearInterval(coreTimers[id]);
                showPopup("CORE CRITICAL", "Time expired. Core access retracted.");
                resetCore(id);
            }
        }, 1000);
    }

    function resetCore(id) {
        clearInterval(coreTimers[id]);
        const block = document.getElementById(`block-${id}`);
        block.classList.remove('unlocked');
        initMathCores(); // Simple refresh for state
    }

    function checkCoreCompletion(coreId) {
        const slots = document.querySelectorAll(`#block-${coreId} .slot`);
        let count = 0;
        slots.forEach(s => { if(s.querySelector('.chip')) count++; });
        if(count === 5) {
            clearInterval(coreTimers[coreId]);
            const msg = `${coreData[coreId].title} CORE STABILIZED! WELL DONE PLAYER.`;
            showPopup(`CORE STABILIZED`, msg);
            speak(msg);
        }
    }

    function processDrop(tId, slot) {
        let t = document.getElementById(tId);
        if(!t || !slot.classList.contains('slot')) return;
        if(t.dataset.ans === slot.dataset.ans) {
            slot.innerHTML = "";
            slot.appendChild(t);
            t.style.position = "static";
            t.style.width = "100%";
            checkCoreCompletion(tId.split('-')[0]);
        }
    }

    // --- TOUCH ENGINE ---
    let activeDrag = null;
    function handleTS(e) { activeDrag = this; this.style.opacity = "0.5"; }
    function handleTM(e) {
        if (!activeDrag) return;
        e.preventDefault();
        let touch = e.touches[0];
        activeDrag.style.position = 'fixed';
        activeDrag.style.zIndex = '5000';
        activeDrag.style.width = '100px';
        activeDrag.style.left = (touch.clientX - 50) + 'px';
        activeDrag.style.top = (touch.clientY - 20) + 'px';
    }
    function handleTE(e) {
        if (!activeDrag) return;
        activeDrag.style.opacity = "1";
        let touch = e.changedTouches[0];
        activeDrag.style.display = 'none';
        let dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
        activeDrag.style.display = 'block';
        let slot = dropTarget ? dropTarget.closest('.slot') : null;
        if (slot) { processDrop(activeDrag.id, slot); } 
        else { activeDrag.style.position = "static"; activeDrag.style.width = "90%"; }
        activeDrag = null;
    }

    // --- RAPID FIRE ENGINE ---
    const rfPool = [
        { q: "Which is heavier: 1kg of Lead or 1kg of Cotton?", o: ["Lead", "Cotton", "Both Same", "Lead (Density)"], a: "Both Same" },
        { q: "If you divide 30 by half and add 10, what is the result?", o: ["25", "70", "40", "15"], a: "70" },
        { q: "How many months have 28 days?", o: ["1", "2", "6", "12"], a: "12" },
        { q: "A farmer has 17 sheep. All but 9 die. How many are left?", o: ["8", "17", "9", "0"], a: "9" },
        { q: "Multiply all numbers on a phone dial pad. Total?", o: ["0", "362880", "123456", "45"], a: "0" },
        { q: "What goes up but never comes down?", o: ["Age", "Balloon", "Smoke", "Gravity"], a: "Age" },
        { q: "Bat and ball cost $1.10. Bat is $1 more than ball. Ball cost?", o: ["$0.10", "$0.05", "$1.00", "$0.15"], a: "$0.05" },
        { q: "How many sides does a circle have?", o: ["0", "1", "2", "Infinite"], a: "Infinite" },
        { q: "If x is the brother of y, but y is NOT the brother of x, who is y?", o: ["Sister", "Mother", "Cousin", "Brother"], a: "Sister" },
        { q: "Which word in the dictionary is spelled 'incorrectly'?", o: ["Incorrectly", "Correct", "Spelled", "Dictionary"], a: "Incorrectly" }
    ];
    let currentRFSet = [], rfIdx = 0, rfTimer;
    function startRapidFire() {
        document.getElementById('start-rf-btn').style.display = 'none';
        document.getElementById('rf-complete-area').style.display = 'none';
        document.getElementById('rf-game-area').style.display = 'block';
        currentRFSet = [...rfPool].sort(() => Math.random() - 0.5).slice(0, 10);
        rfIdx = 0; let time = 150;
        clearInterval(rfTimer);
        rfTimer = setInterval(() => {
            time--;
            let m = Math.floor(time/60), s = time%60;
            document.getElementById('rf-timer').innerText = `${m}:${s<10?'0':''}${s}`;
            if(time <= 0) { clearInterval(rfTimer); resetRF(false); }
        }, 1000);
        showRF();
    }
    function showRF() {
        if(rfIdx >= currentRFSet.length) { 
            clearInterval(rfTimer);
            document.getElementById('rf-game-area').style.display = 'none';
            document.getElementById('rf-complete-area').style.display = 'block';
            speak("Rapid Fire completed. Superior cognitive speed detected.");
            showPopup("RAPID FIRE CLEAR!", "DATASET SYNCED SUCCESSFULLY."); 
            return; 
        }
        let item = currentRFSet[rfIdx];
        document.getElementById('rf-question-text').innerText = `Q${rfIdx+1}: ${item.q}`;
        let opts = document.getElementById('rf-options');
        opts.innerHTML = [...item.o].sort(() => Math.random() - 0.5).map(opt => `<button class="opt-btn" onclick="checkRF('${opt}')">${opt}</button>`).join('');
    }
    function checkRF(choice) {
        if(choice === currentRFSet[rfIdx].a) { rfIdx++; showRF(); } 
        else { alert("SYSTEM ERROR: WRONG ANSWER."); resetRF(false); }
    }
    function resetRF(softReset) {
        clearInterval(rfTimer); rfIdx = 0;
        document.getElementById('rf-timer').innerText = "02:30";
        document.getElementById('rf-game-area').style.display = 'none';
        document.getElementById('rf-complete-area').style.display = 'none';
        document.getElementById('start-rf-btn').style.display = 'inline-block';
        if(softReset) startRapidFire();
    }

    // --- SUDOKU ENGINE (UNTOUCHED QUESTIONS) ---
    const sudokus = [
        { lvl: "Level 1: Novice", sol: "534678912672195348198342567859761423426853791713924856961537284287419635345286179", p: "53.6789126.2195348198.42567859.614234268.379171392.856961.5372842874.9635345286.79", praise: "EXCELLENT START!" },
        { lvl: "Level 2: Apprentice", sol: "417369825632158947958724316825437169791586432346912758289643571573291684164875293", p: "4.73698.56321...479.8724316.254371.97.1.864323.69127.8.8964357157.2.168.1.48752.3", praise: "SUPERIOR PERFORMANCE!" },
        { lvl: "Level 3: Specialist", sol: "152489376739256841468371295387124659591763428246915783813542967675891342924637518", p: "1.2.89.7.7.9.5684.4.837.295.8712.65.5917.342824691.7838.3542.67675891.4.9.46.751.", praise: "SPECIALIST DETECTED." },
        { lvl: "Level 4: Master", sol: "235817946416924358798536214521479863943681725867352491184293567352768149679145382", p: "2.5.179..4169.43.8798.36214521.79.63943.81725.67.5249118429.567.5276.14.6791.5382", praise: "INCREDIBLE. DATA FLOW MASTERED." },
        { lvl: "Level 5: Grandmaster", sol: "812753649943682175675491283154237896369845721287169534521974368438526917796318452", p: "8..7.3..9..36..17.67..91..31.42.7.96.6.8.5.2.28.1.94.45..97..8.4..5..91..9..1.4..2", praise: "GRANDMASTER PROTOCOLS ACTIVATED." },
        { lvl: "Level 6: Robo-Oracle", sol: "534672198678195342912348567859761423426853791713924856961537284287419635345286179", p: "5......98.78...3.2...3.8..7.597...23.......917...2...5.6.5.7.8.2.7.4.6.5......1..", praise: "YOU ARE THE ROBO-ORACLE." }
    ];
    function initSudoku() {
        const vault = document.getElementById('sudoku-vault');
        sudokus.forEach((s, idx) => {
            const wrap = document.createElement('div'); wrap.className = 'sudoku-wrapper';
            wrap.innerHTML = `<div class="level-tag">${s.lvl}</div>`;
            const b = document.createElement('div'); b.className = 'sudoku-board'; b.id = `sudoku-board-${idx}`;
            for(let i=0; i<81; i++) {
                const cell = document.createElement('div'); cell.className = 's-cell';
                if(s.p[i] !== '.') { cell.innerText = s.p[i]; cell.classList.add('prefilled'); } 
                else {
                    const input = document.createElement('input'); input.type = "text"; input.maxLength = 1;
                    input.oninput = (e) => e.target.value = e.target.value.replace(/[^1-9]/g, '');
                    cell.appendChild(input);
                }
                b.appendChild(cell);
            }
            wrap.appendChild(b);
            const btn = document.createElement('button'); btn.className = 'verify-btn'; btn.innerText = "VERIFY INTEGRITY";
            btn.onclick = () => checkSudokuLevel(idx);
            wrap.appendChild(btn); vault.appendChild(wrap);
        });
    }
    function checkSudokuLevel(idx) {
        const board = document.getElementById(`sudoku-board-${idx}`);
        let currentString = "";
        board.querySelectorAll('.s-cell').forEach(cell => {
            if(cell.classList.contains('prefilled')) currentString += cell.innerText;
            else currentString += cell.querySelector('input').value || ".";
        });
        if(currentString === sudokus[idx].sol) {
            showPopup(`VAULT CLEARED!`, sudokus[idx].praise);
            board.style.borderColor = "var(--neon-green)";
            speak("Integrity verified. Vault level " + (idx+1) + " cleared.");
        } else { showPopup(`INTEGRITY ERROR`, `Pattern mismatch.`); }
    }

    function showSection(sid, btn) {
        document.querySelectorAll('.full-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(sid).classList.add('active');
        btn.classList.add('active');
    }
    function showPopup(msg, submsg) {
        document.getElementById('modal-msg').innerText = msg;
        document.getElementById('modal-submsg').innerText = submsg;
        document.getElementById('custom-modal').style.display = 'block';
        document.getElementById('modal-overlay').style.display = 'block';
    }
    function closeModal() {
        document.getElementById('custom-modal').style.display = 'none';
        document.getElementById('modal-overlay').style.display = 'none';
    }
    window.onload = () => { initBG(); initLogic(); initSudoku(); initMathCores(); };
</script>
</body>
</html>
